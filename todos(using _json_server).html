<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODO APP</title>

    <style>
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body{
            min-height:100vh;
            display:flex;
            justify-content:center;
            align-items:center;
            background: linear-gradient(135deg,#4f0f7f,#871b9a,#bd4fc1);
        }

        #container{
            width:420px;
            background:#f5d5e0;
            padding:30px;
            border-radius:15px;
            box-shadow:0 10px 30px rgba(0,0,0,0.4);
        }

        h1{
            text-align:center;
            color:#420d4b;
            margin-bottom:20px;
        }

        input{
            width:100%;
            padding:10px;
            border-radius:8px;
            border:1px solid #6667ab;
            margin-bottom:10px;
            outline:none;
        }

        input:focus{
            border-color:#7b337e;
        }

        #filters{
            display:flex;
            justify-content:space-between;
            margin-bottom:15px;
        }

        button{
            padding:8px 12px;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
            transition:0.3s;
        }

        /* Filter Buttons */
        #filters button{
            background:#6667ab;
            color:white;
        }

        #filters button:hover{
            background:#7b337e;
        }

        /* Add Button */
        #add_btn{
            width:100%;
            background:#681576;
            color:white;
            margin-bottom:15px;
        }

        #add_btn:disabled{
            background:gray;
            cursor:not-allowed;
        }

        #add_btn:hover:not(:disabled){
            background:#420d4b;
        }

        ul{
            list-style:none;
        }

        li{
            background:white;
            padding:10px;
            border-radius:8px;
            margin-bottom:10px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:8px;
        }

        li span{
            flex:1;
            color:#420d4b;
            font-weight:500;
        }

        li button{
            background:#6667ab;
            color:white;
            padding:5px 8px;
            font-size:12px;
        }

        li button:hover{
            background:#7b337e;
        }

        li button:disabled{
            background:gray;
            cursor:not-allowed;
        }

        li button:last-child{
            background:#7b337e;
        }

        li button:last-child:hover{
            background:#420d4b;
        }

        input[type="checkbox"]{
            width:auto;
        }
    </style>
</head>
<body>
    <div id="container">
        <input type="text" id="search" placeholder="ðŸ”Search todos...">
        <br><br>
        <div id="filters">
            <button onclick="filter_todos('all')">All ToDos</button>
            <button onclick="filter_todos('Completed')">Completed</button>
            <button onclick="filter_todos('Not Completed')">Pending...</button>
        </div>
        <br>
        <input type="text" id="input" placeholder="âœðŸ»Enter todo....">
        <button id="add_btn" onclick="insert_into_server()" disabled>Add ToDo</button>
        <ul id="list" type="none">

        </ul>
    </div>
    <!-- script -->
    <script>
        let all_todos=[];
        let edit_id=-1;
        let input_value=document.getElementById("input");
        let add_btn=document.getElementById("add_btn");
        let list=document.getElementById("list");

        // disabling and enabling of add_btn
        input_value.addEventListener("input",function(){
            if(input_value.value.trim()===""){
                add_btn.disabled=true;
            }
            else{
                add_btn.disabled=false;
            }
        })

        //load todos on reloading the page
        window.onload=load_todos; 

        function load_todos(){
            fetch("http://localhost:3000/todo_app")
            .then(res => res.json())
            .then(data => {
                all_todos=data;
                display_todos(data);
            });
        }

        //displaying todos
        function display_todos(data){
            list.innerHTML = "";
            data.forEach(todo => {
                gen_list(todo);
            });
        }

        //filtering the todos
        function filter_todos(type){
            if(type === "all"){
                display_todos(all_todos);
            }
            else{
                let filtered = all_todos.filter(todo => 
                    todo.Status === type
                );
                display_todos(filtered);
            }
        }

        //editing the todo
        function edit_todo(todo){
            input_value.value=todo.Title;
            add_btn.innerText="Update ToDo"
            add_btn.disabled=false;
            edit_id=todo.id;
        }

        //deleting the todo
        function del_todo(todo){
            fetch(`http://localhost:3000/todo_app/${todo.id}`,{
                method:"DELETE"   
            })
            .then(()=>{
                load_todos();
            });
        }

        //creation of list items 
        function gen_list(todo){
            let listitem=document.createElement("li");
           
            //checkbox
            let checkbox=document.createElement("input");
            checkbox.type="checkbox";
            
            //todo title
            let todo_title=document.createElement("span");
            todo_title.innerText=todo.Title;

            //edit button
            let edit_btn=document.createElement("button");
            edit_btn.innerText="Edit";
            edit_btn.onclick=function(){
                edit_todo(todo);
            }
            
            //delete button
            let del_btn=document.createElement("button");
            del_btn.innerText="Delete";
            del_btn.onclick=function (){
                del_todo(todo);
            }
           
            //checkbox status
            if(todo.Status == "Completed"){
                checkbox.checked = true;
                todo_title.style.textDecoration="line-through";
                edit_btn.disabled=true;
            }
            checkbox.onchange=function(){
                let new_status=checkbox.checked ? "Completed" : "Not Completed";
                fetch(`http://localhost:3000/todo_app/${todo.id}`,{
                    method:"PATCH",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({
                        Status:new_status
                    })
                })
                .then(()=>{
                    load_todos();
                });
            };

            //appending elements
            listitem.append(checkbox,todo_title,edit_btn,del_btn);
            document.querySelector("#list").appendChild(listitem);
        }

        //inserting / updating values into json server (click function on add button)
        function insert_into_server(){
            if(edit_id==-1){
                fetch("http://localhost:3000/todo_app",{
                    method:"POST",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({
                        Title: input_value.value,
                        Status:"Not Completed"
                    })
                })
                .then(res => res.json())
                .then(data =>{
                    gen_list(data);
                });
            }
            else{
                fetch(`http://localhost:3000/todo_app/${edit_id}`,{
                    method:"PATCH",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({
                        Title:input_value.value
                    })
                })
                .then(()=>{
                    load_todos();
                })
                edit_id=-1;
                add_btn.innerText="Add ToDo";
            }
            input_value.value="";
            add_btn.disabled=true;
        }

        //searching for todos
        let search_input = document.getElementById("search");
        search_input.addEventListener("input", function(){
            let search_value = search_input.value.toLowerCase();
            let filtered = all_todos.filter(todo =>
                todo.Title.toLowerCase().includes(search_value)
            );
            display_todos(filtered);
        });
    </script>
</body>
</html>